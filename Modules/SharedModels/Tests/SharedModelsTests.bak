//
//  SharedModelsTests.swift
//  SharedModelsTests
//
//  Created by Graham Hindle on 18/07/2025.
//
import CustomDump
import DependenciesTestSupport
import InlineSnapshotTesting
import SharingGRDB
import SharedModels
import SnapshotTestingCustomDump
import Testing

@testable import ProfileFeature

@Suite(
    .dependency(\.defaultDatabase, try appDatabase()),
    .snapshots(record: .failed)
)
struct SharedModelsTests {

    @Test func deletion() async throws {
        let model = ProfileModel()

        try await model.$profileRows.load()

        assertInlineSnapshot(of: model.profileRows, as: .customDump) {
            """
            [
              [0]: Profile(
                id: 3,
                fullName: "Alice Smith",
                email: "alice.smith@example.com",
                dateOfBirth: nil,
                themeColorHex: 682051071
              ),
              [1]: Profile(
                id: 1,
                fullName: "Graham",
                email: "user123@example.com",
                dateOfBirth: nil,
                themeColorHex: 4283905023
              ),
              [2]: Profile(
                id: 2,
                fullName: "Jane Doe",
                email: "jane.doe@example.com",
                dateOfBirth: nil,
                themeColorHex: 1116206591
              )
            ]
            """
        }
        model.deleteButtonTapped(indexSet: [1])
        try await model.$profileRows.load()
        assertInlineSnapshot(of: model.profileRows, as: .customDump) {
            """
            [
              [0]: Profile(
                id: 3,
                fullName: "Alice Smith",
                email: "alice.smith@example.com",
                dateOfBirth: nil,
                themeColorHex: 682051071
              ),
              [1]: Profile(
                id: 2,
                fullName: "Jane Doe",
                email: "jane.doe@example.com",
                dateOfBirth: nil,
                themeColorHex: 1116206591
              )
            ]
            """
        }

        
    }

}
